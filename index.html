<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hardware Savings Calculator | Sighthound</title>
    <!-- Fonts: Poppins for headings and body text -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Configure Tailwind CDN to use class-based dark mode
      tailwind.config = {
        darkMode: "class",
      };
    </script>
    <style>
      :root {
        --font-body: "Poppins", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
        --font-heading: "Poppins", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
      }

      body {
        font-family: var(--font-body);
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-family: var(--font-heading);
      }

      /* Screen/print helpers */
      .no-print {
      }

      .print-only {
        display: none;
      }

      @media print {
        @page {
          size: auto;
          margin: 0.5in;
        }

        body {
          background: #ffffff;
          font-size: 0.8rem;
        }

        h1 {
          font-size: 1.15rem;
        }

        h2,
        h3 {
          font-size: 0.95rem;
        }

        .no-print {
          display: none !important;
        }

        .print-only {
          display: block !important;
        }

        /* Tighter layout for PDF */
        .max-w-6xl {
          max-width: 7.5in !important;
          padding-top: 0.25rem !important;
          padding-bottom: 0.25rem !important;
        }

        main {
          padding: 0 !important;
        }

        /* Stack inputs/results vertically for PDF export */
        #layoutGrid {
          display: flex !important;
          flex-direction: column !important;
          gap: 0.5rem !important;
          align-items: stretch !important;
        }

        /* Print: show results above inputs */
        #layoutGrid > section:first-of-type {
          /* Inputs column ("Your setup") */
          order: 2;
          page-break-before: always;
          break-before: page;
        }

        #layoutGrid > section:last-of-type {
          /* Results column ("Your hardware costs" etc.) */
          order: 1;
        }

        /* Compact cards and sections */
        .bg-slate-50,
        .bg-white,
        .bg-gradient-to-br,
        .bg-gradient-to-r {
          padding-top: 0.6rem !important;
          padding-bottom: 0.6rem !important;
          padding-left: 0.75rem !important;
          padding-right: 0.75rem !important;
        }

        .space-y-4 > :not([hidden]) ~ :not([hidden]) {
          --tw-space-y-reverse: 0;
          margin-top: calc(0.6rem * calc(1 - var(--tw-space-y-reverse))) !important;
          margin-bottom: calc(0.6rem * var(--tw-space-y-reverse)) !important;
        }

        .mt-4 {
          margin-top: 0.5rem !important;
        }

        .mb-6 {
          margin-bottom: 0.75rem !important;
        }

        .py-8,
        .sm\:py-10 {
          padding-top: 0.75rem !important;
          padding-bottom: 0.75rem !important;
        }

        .text-3xl,
        .text-4xl {
          font-size: 1.35rem !important;
        }
      }
    </style>
  </head>
  <body class="min-h-screen bg-white text-slate-900 antialiased">
    <div class="min-h-screen">
      <!-- Main content -->
      <main class="flex-1">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-10">
          <div class="mb-6 space-y-3 text-sm sm:text-base text-slate-600 dark:text-slate-300 no-print">
            <p>
              Most AI camera deployments push compute into every camera. That works, but it’s often expensive and inflexible.
            </p>
            <p>
              Sighthound takes a different approach. AI runs on a dedicated Compute Node that connects to standard IP cameras, making them smart without replacing your existing infrastructure.
            </p>
            <p>
              Use this calculator to compare upfront hardware costs side by side.
            </p>
          </div>
          <section class="mb-6 space-y-2 text-sm text-slate-600 dark:text-slate-300 no-print">
            <h2 class="text-sm font-semibold text-slate-900 dark:text-slate-50">
              How this works
            </h2>
            <div class="mt-1 inline-flex flex-wrap items-center gap-2 text-[11px] sm:text-xs font-medium text-slate-700 dark:text-slate-200">
              <div class="inline-flex items-center gap-1 rounded-full bg-slate-100 px-2.5 py-1 dark:bg-slate-800">
                <span class="h-1.5 w-1.5 rounded-full bg-slate-900 dark:bg-slate-100"></span>
                <span class="uppercase tracking-wide">Step 1</span>
                <span class="text-slate-500 dark:text-slate-400">Enter cameras &amp; hardware costs</span>
              </div>
              <div class="inline-flex items-center gap-1 rounded-full bg-slate-100 px-2.5 py-1 dark:bg-slate-800">
                <span class="h-1.5 w-1.5 rounded-full bg-sky-600"></span>
                <span class="uppercase tracking-wide">Step 2</span>
                <span class="text-slate-500 dark:text-slate-400">Review savings &amp; deployment details</span>
              </div>
              <span class="ml-1 text-[11px] font-normal text-sky-700 dark:text-sky-400">
                Updates instantly as you type.
              </span>
            </div>
          </section>
          <div id="layoutGrid" class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8 items-start">
            <!-- Inputs column -->
            <section class="bg-slate-50 rounded-xl shadow-md border border-slate-200/80 p-5 sm:p-6 space-y-5">
              <h2 class="text-base font-semibold text-slate-900 dark:text-slate-50">
                Your setup
              </h2>
              <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
                Answer a few questions about your deployment. Results update as you go.
              </p>

              <!-- SECTION 1: CAMERAS -->
              <div id="sectionCameras" class="space-y-4">
                <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-500 flex items-center gap-2 dark:text-slate-400">
                  <span class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-slate-900 text-[11px] font-semibold text-white">1</span>
                  <span>Cameras</span>
                </h3>
                <!-- Total cameras -->
                <div class="space-y-1.5">
                  <label
                    for="totalCameras"
                    class="block text-sm font-medium text-slate-700 dark:text-slate-200"
                  >
                    Total number of cameras
                    <span
                      class="ml-2 inline-flex items-center rounded-full bg-rose-50 px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide text-rose-600 dark:bg-rose-950/40 dark:text-rose-300"
                    >
                      Required
                    </span>
                    <button
                      type="button"
                      class="ml-1 inline-flex h-4 w-4 items-center justify-center rounded-full border border-slate-300 bg-white text-[10px] font-semibold text-slate-500 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-1"
                      data-helper-target="totalCamerasHelper"
                      aria-label="Help: total number of cameras"
                    >
                      ⓘ
                    </button>
                  </label>
                  <input
                    id="totalCameras"
                    type="number"
                    inputmode="numeric"
                    min="1"
                    max="10000"
                    step="1"
                    placeholder="Total cameras"
                    class="block w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100"
                  />
                  <p
                    id="totalCamerasHelper"
                    class="text-xs text-slate-500 dark:text-slate-400 hidden"
                  >
                    The total number of camera streams you want to analyze. Each camera counts as one stream.
                  </p>
                </div>

                <!-- Existing standard IP cameras toggle -->
                <div class="space-y-1.5">
                  <p class="block text-sm font-medium text-slate-700 dark:text-slate-200">
                    Do you already have standard IP cameras installed?
                    <button
                      type="button"
                      class="ml-1 inline-flex h-4 w-4 items-center justify-center rounded-full border border-slate-300 bg-white text-[10px] font-semibold text-slate-500 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-1"
                      data-helper-target="standardIpHelper"
                      aria-label="Help: standard IP cameras"
                    >
                      ⓘ
                    </button>
                  </p>
                  <div class="flex items-center gap-2 text-xs text-slate-600 dark:text-slate-300">
                    <input
                      id="existingCamerasToggle"
                      type="checkbox"
                      class="h-3.5 w-3.5 rounded border-slate-300 text-sky-600 focus:ring-sky-500 dark:border-slate-600"
                    />
                    <label for="existingCamerasToggle" class="select-none">
                      Yes, we already have standard IP cameras installed.
                    </label>
                  </div>
                  <p
                    id="standardIpHelper"
                    class="text-xs text-slate-500 dark:text-slate-400 hidden"
                  >
                    Standard IP cameras capture video only. They do not run analytics like license plate recognition inside the camera.
                  </p>
                </div>

                <!-- Smart / edge cameras toggle -->
                <div class="space-y-1.5">
                  <p class="block text-sm font-medium text-slate-700 dark:text-slate-200">
                    Do you currently use smart / edge cameras with built-in analytics?
                    <button
                      type="button"
                      class="ml-1 inline-flex h-4 w-4 items-center justify-center rounded-full border border-slate-300 bg-white text-[10px] font-semibold text-slate-500 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-1"
                      data-helper-target="smartCamerasHelper"
                      aria-label="Help: smart / edge cameras"
                    >
                      ⓘ
                    </button>
                  </p>
                  <div class="flex items-center gap-2 text-xs text-slate-600 dark:text-slate-300">
                    <input
                      id="smartCamerasToggle"
                      type="checkbox"
                      class="h-3.5 w-3.5 rounded border-slate-300 text-sky-600 focus:ring-sky-500 dark:border-slate-600"
                    />
                    <label for="smartCamerasToggle" class="select-none">
                      Yes, we currently use smart / edge cameras with built-in analytics.
                    </label>
                  </div>
                  <p
                    id="smartCamerasHelper"
                    class="text-xs text-slate-500 dark:text-slate-400 hidden"
                  >
                    Smart or edge cameras process analytics inside the camera itself and typically cost more because each unit includes compute and software.
                  </p>
                  <p
                    id="cameraTypeExclusivityNote"
                    class="text-xs text-amber-700 dark:text-amber-400 hidden"
                  >
                    A camera cannot be both standard and smart at the same time.
                  </p>
                </div>
              </div>

              <!-- SECTION 2: CURRENT APPROACH (SMART CAMERAS) -->
              <div
                id="sectionCurrentApproach"
                class="space-y-4 pt-4 border-t border-slate-200 dark:border-slate-700"
              >
                <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-500 flex items-center gap-2 dark:text-slate-400">
                  <span class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-slate-900 text-[11px] font-semibold text-white">2</span>
                  <span>Current approach (smart cameras)</span>
                </h3>
                <!-- Smart camera cost -->
                <div class="space-y-1.5">
                  <label
                    for="smartCameraCost"
                    class="block text-sm font-medium text-slate-700 dark:text-slate-200"
                  >
                    Estimated cost per smart camera
                    <button
                      type="button"
                      class="ml-1 inline-flex h-4 w-4 items-center justify-center rounded-full border border-slate-300 bg-white text-[10px] font-semibold text-slate-500 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-1"
                      data-helper-target="smartCameraHelper"
                      aria-label="Help: smart camera cost"
                    >
                      ⓘ
                    </button>
                  </label>
                  <div class="relative rounded-lg shadow-sm max-w-xs">
                    <div
                      class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-slate-500 text-sm"
                    >
                      $
                    </div>
                    <input
                      id="smartCameraCost"
                      type="number"
                      inputmode="decimal"
                      min="1"
                      max="10000"
                      step="1"
                      value="3000"
                      class="block w-full rounded-lg border border-slate-300 bg-white pl-7 pr-3 py-2 text-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100"
                    />
                  </div>
                  <p
                    id="smartCameraHelper"
                    class="text-xs text-slate-500 dark:text-slate-400 hidden"
                  >
                    Used only as a comparison baseline representing what you typically pay today for smart or edge cameras.
                  </p>
                </div>
              </div>

              <!-- SECTION 3: WITH SIGHTHOUND -->
              <div
                id="sectionSighthound"
                class="space-y-4 pt-4 border-t border-slate-200 dark:border-slate-700"
              >
                <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-500 flex items-center gap-2 dark:text-slate-400">
                  <span class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-slate-900 text-[11px] font-semibold text-white">3</span>
                  <span>With Sighthound Compute Node</span>
                </h3>

                <!-- Standard IP camera cost (only when not reusing cameras) -->
                <div id="standardIpCameraCostGroup" class="space-y-1.5">
                  <label
                    for="dumbCameraCost"
                    class="block text-sm font-medium text-slate-700 dark:text-slate-200"
                  >
                    Estimated cost per standard IP camera
                    <button
                      type="button"
                      class="ml-1 inline-flex h-4 w-4 items-center justify-center rounded-full border border-slate-300 bg-white text-[10px] font-semibold text-slate-500 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-1"
                      data-helper-target="standardIpCostHelper"
                      aria-label="Help: standard IP camera cost"
                    >
                      ⓘ
                    </button>
                  </label>
                  <div class="relative rounded-lg shadow-sm max-w-xs">
                    <div
                      class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-slate-500 text-sm"
                    >
                      $
                    </div>
                    <input
                      id="dumbCameraCost"
                      type="number"
                      inputmode="decimal"
                      min="1"
                      max="10000"
                      step="1"
                      value="250"
                      class="block w-full rounded-lg border border-slate-300 bg-white pl-7 pr-3 py-2 text-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100"
                    />
                  </div>
                  <p
                    id="standardIpCostHelper"
                    class="text-xs text-slate-500 dark:text-slate-400 hidden"
                  >
                    Typical hardware cost for a basic IP camera without analytics.
                  </p>
                </div>
                <p
                  id="scenarioBNote"
                  class="text-xs text-slate-500 dark:text-slate-400 hidden"
                >
                  Existing cameras are reused. No camera hardware replacement assumed.
                </p>

                <!-- Sighthound software selection -->
                <div class="space-y-2">
                  <p class="text-sm font-medium text-slate-700 dark:text-slate-200">
                    Sighthound software analytics
                    <button
                      type="button"
                      class="ml-1 inline-flex h-4 w-4 items-center justify-center rounded-full border border-slate-300 bg-white text-[10px] font-semibold text-slate-500 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-1"
                      data-helper-target="softwareMainHelper"
                      aria-label="Help: Sighthound software analytics"
                    >
                      ⓘ
                    </button>
                  </p>
                  <p
                    id="softwareMainHelper"
                    class="text-xs text-slate-500 dark:text-slate-400 hidden"
                  >
                    Software is priced per camera stream and billed separately from hardware.
                  </p>
                  <div class="mt-1 grid grid-cols-1 sm:grid-cols-3 gap-2 text-xs">
                    <label class="flex items-start gap-2 rounded-lg border border-slate-200 bg-white px-3 py-2 cursor-pointer dark:border-slate-700 dark:bg-slate-900">
                      <input
                        type="radio"
                        name="softwareSelection"
                        value="lpr"
                        class="mt-0.5 h-3.5 w-3.5 text-sky-600 border-slate-300 focus:ring-sky-500 dark:border-slate-600"
                      />
                      <span class="flex flex-col">
                        <span class="font-medium text-slate-800 dark:text-slate-100">
                          LPR only
                          <button
                            type="button"
                            class="ml-1 inline-flex h-3.5 w-3.5 items-center justify-center rounded-full border border-slate-300 bg-white text-[9px] font-semibold text-slate-500 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-1"
                            data-helper-target="lprHelper"
                            aria-label="Help: LPR only"
                          >
                            ⓘ
                          </button>
                        </span>
                        <span class="text-[11px] text-slate-500 dark:text-slate-400">$30 / camera / month</span>
                        <span
                          id="lprHelper"
                          class="text-[11px] text-slate-500 dark:text-slate-400 hidden"
                        >
                          License Plate Recognition analytics per camera stream.
                        </span>
                      </span>
                    </label>
                    <label class="flex items-start gap-2 rounded-lg border border-slate-200 bg-white px-3 py-2 cursor-pointer dark:border-slate-700 dark:bg-slate-900">
                      <input
                        type="radio"
                        name="softwareSelection"
                        value="mmcg"
                        class="mt-0.5 h-3.5 w-3.5 text-sky-600 border-slate-300 focus:ring-sky-500 dark:border-slate-600"
                      />
                      <span class="flex flex-col">
                        <span class="font-medium text-slate-800 dark:text-slate-100">
                          MMCG only
                          <button
                            type="button"
                            class="ml-1 inline-flex h-3.5 w-3.5 items-center justify-center rounded-full border border-slate-300 bg-white text-[9px] font-semibold text-slate-500 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-1"
                            data-helper-target="mmcgHelper"
                            aria-label="Help: MMCG only"
                          >
                            ⓘ
                          </button>
                        </span>
                        <span class="text-[11px] text-slate-500 dark:text-slate-400">$30 / camera / month</span>
                        <span
                          id="mmcgHelper"
                          class="text-[11px] text-slate-500 dark:text-slate-400 hidden"
                        >
                          Make / Model / Color / Generation (vehicle analytics) per camera stream.
                        </span>
                      </span>
                    </label>
                    <label class="flex items-start gap-2 rounded-lg border border-slate-200 bg-white px-3 py-2 cursor-pointer dark:border-slate-700 dark:bg-slate-900">
                      <input
                        type="radio"
                        name="softwareSelection"
                        value="both"
                        checked
                        class="mt-0.5 h-3.5 w-3.5 text-sky-600 border-slate-300 focus:ring-sky-500 dark:border-slate-600"
                      />
                      <span class="flex flex-col">
                        <span class="font-medium text-slate-800 dark:text-slate-100">
                          Both (LPR + MMCG)
                          <button
                            type="button"
                            class="ml-1 inline-flex h-3.5 w-3.5 items-center justify-center rounded-full border border-slate-300 bg-white text-[9px] font-semibold text-slate-500 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-1"
                            data-helper-target="bothHelper"
                            aria-label="Help: LPR + MMCG"
                          >
                            ⓘ
                          </button>
                        </span>
                        <span class="text-[11px] text-slate-500 dark:text-slate-400">$55 / camera / month</span>
                        <span
                          id="bothHelper"
                          class="text-[11px] text-slate-500 dark:text-slate-400 hidden"
                        >
                          Combined LPR and MMCG analytics per camera stream.
                        </span>
                      </span>
                    </label>
                  </div>
                </div>

                <!-- Billing frequency -->
                <div class="space-y-1.5">
                  <label
                    for="softwareBillingFrequency"
                    class="block text-sm font-medium text-slate-700 dark:text-slate-200"
                  >
                    Billing frequency
                    <button
                      type="button"
                      class="ml-1 inline-flex h-4 w-4 items-center justify-center rounded-full border border-slate-300 bg-white text-[10px] font-semibold text-slate-500 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-1"
                      data-helper-target="billingHelper"
                      aria-label="Help: billing frequency"
                    >
                      ⓘ
                    </button>
                  </label>
                  <select
                    id="softwareBillingFrequency"
                    class="mt-1 block max-w-xs rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-sky-500 focus:ring-1 focus:ring-sky-500 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100"
                  >
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly (annualized)</option>
                  </select>
                  <p
                    id="billingHelper"
                    class="text-xs text-slate-500 dark:text-slate-400 hidden"
                  >
                    This only affects recurring software cost. Hardware costs and savings do not change.
                  </p>
                </div>
              </div>

              <div class="mt-2 flex items-center justify-end">
                <button
                  id="resetCalculatorButton"
                  type="button"
                  class="inline-flex items-center justify-center rounded-lg border border-slate-300 px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 dark:border-slate-600 dark:text-slate-100 dark:hover:bg-slate-800 dark:focus-visible:ring-offset-slate-900"
                >
                  <span aria-hidden="true" class="mr-1.5 text-[0.8rem]">
                    ↻
                  </span>
                  <span>Reset inputs</span>
                </button>
              </div>
            </section>

            <!-- Results column -->
            <section class="space-y-4">
              <!-- Header shown above results (also used in print/PDF) -->
              <div class="mb-4 flex items-center justify-between gap-3">
                <div>
                  <h1 class="text-xl font-semibold text-slate-900">
                    Hardware savings estimate
                  </h1>
                  <p class="mt-1 text-xs text-slate-500">
                    Generated with the Sighthound hardware savings calculator.
                  </p>
                </div>
                <img
                  src="assets/sighthound-logo-black.png"
                  alt="Sighthound logo"
                  class="h-5"
                />
              </div>
              <!-- Placeholder state -->
              <div
                id="resultsPlaceholder"
                class="bg-slate-50 rounded-xl shadow-md border border-dashed border-slate-300 p-6 flex items-center justify-center text-center min-h-[220px]"
              >
                <p class="text-sm text-slate-500 dark:text-slate-400">
                  Enter your camera count to see results.
                </p>
              </div>

              <!-- Results -->
              <div id="resultsPanel" class="hidden">
                <!-- Cost comparison -->
                <div
                  id="costComparisonCard"
                  class="bg-slate-50 rounded-xl shadow-md border border-slate-200/80 p-5 sm:p-6"
                >
                  <h3 class="text-sm font-semibold text-slate-800 mb-1 dark:text-slate-50">
                    Your hardware costs
                  </h3>
                  <p class="mb-3 text-xs text-slate-500 dark:text-slate-400">
                    A side-by-side view of todays approach versus Sighthound Compute Hardware.
                  </p>
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Today -->
                    <div class="border border-slate-200 rounded-lg p-4 flex flex-col gap-1.5 dark:border-slate-700">
                      <p class="flex items-center justify-between gap-2 text-xs font-medium text-slate-600 uppercase tracking-wide dark:text-slate-400">
                        <span id="todayLabelText">Today  smart AI cameras</span>
                        <span
                          class="inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-slate-600 dark:bg-slate-800 dark:text-slate-300"
                        >
                          Before
                        </span>
                      </p>
                      <p
                        id="currentTotalValue"
                        class="text-lg font-semibold tabular-nums text-slate-900 dark:text-slate-50"
                      >
                        $0.00
                      </p>
                    </div>

                    <!-- Sighthound -->
                    <div class="border border-sky-300 rounded-lg p-4 flex flex-col gap-1.5 bg-sky-50/70 shadow-sm dark:border-sky-500/70 dark:bg-sky-950/40">
                      <p class="text-xs font-medium text-slate-700 uppercase tracking-wide flex items-center justify-between gap-2 dark:text-slate-100">
                        <span id="sighthoundLabelText">With Sighthound Compute Hardware</span>
                        <span class="inline-flex items-center rounded-full bg-sky-600/10 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-sky-700 dark:bg-sky-500/20 dark:text-sky-200">
                          After
                        </span>
                      </p>
                      <p
                        id="sighthoundTotalValue"
                        class="text-lg sm:text-xl font-semibold tabular-nums text-slate-900 dark:text-slate-50"
                      >
                        $0.00
                      </p>
                    </div>
                  </div>

                  <!-- Existing camera choice is now configured in the left column (Section 1) -->

                  <!-- Progressive breakdown -->
                  <div class="mt-4 border-t border-slate-200 pt-4 dark:border-slate-700">
                    <button
                      id="breakdownToggle"
                      type="button"
                      class="text-xs font-medium text-sky-700 hover:text-sky-800 flex items-center gap-1 dark:text-sky-400 dark:hover:text-sky-300"
                      aria-expanded="false"
                    >
                      <span>Show breakdown</span>
                      <span class="text-[10px]">▼</span>
                    </button>
                    <p
                      id="breakdownHelper"
                      class="mt-1 text-[11px] text-slate-500 dark:text-slate-400 hidden"
                    >
                      See exactly how each total is calculated.
                    </p>
                    <div
                      id="breakdownPanel"
                      class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4 text-xs text-slate-600 tabular-nums hidden dark:text-slate-400"
                    >
                      <div class="space-y-1.5">
                        <p class="font-medium text-slate-700 dark:text-slate-200">Today</p>
                        <p id="todayBreakdownLine" class="text-slate-600 dark:text-slate-400">
                          Cameras: –
                        </p>
                      </div>
                      <div class="space-y-1.5">
                        <p class="font-medium text-slate-700 dark:text-slate-200">Sighthound Compute Hardware</p>
                        <p id="sighthoundBreakdownNodes" class="text-slate-600 dark:text-slate-400">
                          Compute Nodes: 2
                        </p>
                        <p id="sighthoundBreakdownCameras" class="text-slate-600 dark:text-slate-400">
                          Cameras: 2
                        </p>
                      </div>
                      <div
                        id="softwareBreakdown"
                        class="sm:col-span-2 border-t border-slate-200 pt-2 mt-2 dark:border-slate-700"
                      >
                        <p
                          id="softwareBreakdownHeading"
                          class="font-medium text-slate-700 dark:text-slate-200"
                        >
                          Your software costs (recurring)
                        </p>
                        <p
                          id="softwareBreakdownLine"
                          class="text-slate-600 dark:text-slate-400"
                        >
                          Software costs are calculated per camera per month and shown separately from hardware.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Savings card -->
                <div
                  id="primaryCard"
                  class="mt-4 rounded-xl shadow-sm border border-slate-200 bg-gradient-to-br from-sky-50/80 via-slate-50 to-emerald-50/80 p-5 sm:p-6 flex flex-col gap-3 dark:border-slate-700 dark:from-slate-900 dark:via-slate-900 dark:to-slate-900"
                >
                  <div class="flex items-start justify-between gap-4">
                    <div>
                      <p
                        id="primaryLabel"
                        class="text-sm font-medium text-slate-700 flex items-center gap-1.5 dark:text-slate-200"
                      >
                        <span id="primaryLabelText">Savings vs today</span>
                        <button
                          type="button"
                          class="ml-1 inline-flex h-4 w-4 items-center justify-center rounded-full border border-slate-300 bg-white text-[10px] font-semibold text-slate-500 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-1"
                          data-helper-target="savingsHelper"
                          aria-label="Help: savings"
                        >
                          ⓘ
                        </button>
                      </p>
                      <p
                        id="primaryValue"
                        class="mt-1 text-3xl sm:text-4xl font-semibold tracking-tight tabular-nums"
                      >
                        $0.00
                      </p>
                      <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">
                        Difference between smart AI cameras (today) and Sighthound Compute Node + standard IP cameras (hardware only).
                      </p>
                      <p
                        id="savingsHelper"
                        class="mt-1 text-xs text-slate-500 dark:text-slate-400 hidden"
                      >
                        Hardware-only comparison.
                      </p>
                    </div>
                    <div class="flex flex-col items-end gap-2">
                      <div
                        id="primaryArrow"
                        class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-emerald-50 text-emerald-600 dark:bg-emerald-950 dark:text-emerald-400"
                        aria-hidden="true"
                      >
                        <svg
                          id="primaryArrowIcon"
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                          class="h-4 w-4"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M10 2a.75.75 0 0 1 .75.75v12.638l3.72-3.719a.75.75 0 1 1 1.06 1.06l-5.25 5.25a.75.75 0 0 1-1.06 0l-5.25-5.25a.75.75 0 1 1 1.06-1.06l3.72 3.719V2.75A.75.75 0 0 1 10 2Z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </div>
                    </div>
                  </div>
                  <p
                    id="recommendationText"
                    class="text-xs text-slate-600 dark:text-slate-300"
                  >
                    Enter your camera count and costs to see whether Sighthound is cheaper or more expensive than today.
                  </p>
                </div>

                <!-- Secondary metrics -->
                <div
                  id="deploymentDetailsCard"
                  class="mt-4 bg-white rounded-xl shadow-sm border border-slate-200 p-5 sm:p-6 space-y-4 dark:bg-slate-900 dark:border-slate-700"
                >
                  <h3 class="text-sm font-semibold text-slate-800 dark:text-slate-50">
                    Deployment details
                  </h3>
                  <p
                    id="deploymentDetailsIntro"
                    class="text-xs text-slate-500 dark:text-slate-400"
                  >
                    A quick breakdown of Compute Nodes required, cost reduction, and cost per camera.
                  </p>
                  <p class="text-[11px] text-slate-500 dark:text-slate-500">
                    Assumes a typical maximum camera count per Compute Node under standard workloads. Your actual node count may vary based on retention and AI workloads.
                  </p>
                  <dl class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm">
                    <div class="space-y-1">
                      <dt class="text-xs text-slate-500 dark:text-slate-400">
                        Compute Nodes required
                        <button
                          type="button"
                          class="ml-1 inline-flex h-4 w-4 items-center justify-center rounded-full border border-slate-300 bg-white text-[10px] font-semibold text-slate-500 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-1"
                          data-helper-target="nodesHelper"
                          aria-label="Help: nodes required"
                        >
                          ⓘ
                        </button>
                      </dt>
                      <dd
                        id="nodesNeededValue"
                        class="font-medium tabular-nums text-slate-900 dark:text-slate-50"
                      >
                        0
                      </dd>
                      <p
                        id="nodesHelper"
                        class="text-[11px] text-slate-500 dark:text-slate-400 hidden"
                      >
                        Each node supports up to 4 cameras. Rounded up.
                      </p>
                    </div>

                    <div id="percentReductionGroup" class="space-y-1">
                      <dt class="text-xs text-slate-500 dark:text-slate-400">% reduction</dt>
                      <dd class="flex items-center gap-1.5">
                        <span
                          id="percentReductionValue"
                          class="font-medium tabular-nums text-emerald-600"
                        >
                          0.0%
                        </span>
                        <span
                          id="percentArrowIcon"
                          class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-emerald-50 text-emerald-600 dark:bg-emerald-950 dark:text-emerald-400"
                          aria-hidden="true"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                            class="h-3 w-3"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M10 2a.75.75 0 0 1 .75.75v12.638l3.72-3.719a.75.75 0 1 1 1.06 1.06l-5.25 5.25a.75.75 0 0 1-1.06 0l-5.25-5.25a.75.75 0 1 1 1.06-1.06l3.72 3.719V2.75A.75.75 0 0 1 10 2Z"
                              clip-rule="evenodd"
                            />
                          </svg>
                        </span>
                      </dd>
                    </div>

                    <div class="space-y-1">
                      <dt
                        id="costPerCameraLabel"
                        class="text-xs text-slate-500 dark:text-slate-400"
                      >
                        Cost per camera (hardware only)
                        <button
                          type="button"
                          class="ml-1 inline-flex h-4 w-4 items-center justify-center rounded-full border border-slate-300 bg-white text-[10px] font-semibold text-slate-500 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-1"
                          data-helper-target="costPerCameraHelper"
                          aria-label="Help: cost per camera"
                        >
                          ⓘ
                        </button>
                      </dt>
                      <dd class="space-y-0.5">
                        <div
                          id="costPerCameraBeforeRow"
                          class="flex items-center justify-between gap-2"
                        >
                          <span class="text-xs text-slate-500 dark:text-slate-400">Before</span>
                          <span
                            id="costPerCameraBeforeValue"
                            class="font-medium tabular-nums text-slate-900 dark:text-slate-50"
                          >
                            $0.00
                          </span>
                        </div>
                        <div
                          id="costPerCameraAfterRow"
                          class="flex items-center justify-between gap-2"
                        >
                          <span class="text-xs text-slate-500 dark:text-slate-400">After</span>
                          <span
                            id="costPerCameraAfterValue"
                            class="font-medium tabular-nums text-slate-900 dark:text-slate-50"
                          >
                            $0.00
                          </span>
                        </div>
                      </dd>
                      <p
                        id="costPerCameraHelper"
                        class="text-[11px] text-slate-500 dark:text-slate-400 hidden"
                      >
                        Average hardware cost across deployment.
                      </p>
                    </div>
                  </dl>

                  <!-- Software overview (recurring, Sighthound only) -->
                  <div
                    id="softwareOverview"
                    class="mt-4 border-t border-slate-200 pt-4 space-y-1 text-xs text-slate-500 dark:border-slate-700 dark:text-slate-400"
                  >
                    <p
                      id="softwareOverviewHeading"
                      class="font-semibold text-slate-700 dark:text-slate-200"
                    >
                      Your software costs (recurring)
                    </p>
                    <p id="softwareRecurringSummary">
                      Software cost will appear here once cameras are entered.
                    </p>
                    <p id="softwareBillingNote" class="text-[11px] text-slate-500 dark:text-slate-500">
                      Software is billed per camera (per stream). Hardware and software costs are kept separate in all totals.
                    </p>
                  </div>
                </div>

                <!-- CTA -->
                <aside
                  class="mt-4 rounded-xl shadow-sm border border-slate-200 bg-gradient-to-r from-slate-50 to-slate-100/80 p-5 sm:p-6 flex flex-col gap-3 dark:border-slate-700 dark:from-slate-900 dark:to-slate-900 no-print"
                >
                  <h3 class="text-sm font-semibold text-slate-900 dark:text-slate-50">
                    Export and next steps
                  </h3>
                  <div class="mt-1 flex flex-col gap-2">
                    <button
                      id="downloadPdfButton"
                      type="button"
                      class="inline-flex items-center justify-center rounded-lg border border-slate-300 px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 dark:border-slate-600 dark:text-slate-100 dark:hover:bg-slate-800"
                    >
                      Download estimate as PDF
                    </button>
                    <a
                      id="contactCtaLink"
                      href="https://www.sighthound.com/contact-us"
                      class="inline-flex items-center justify-center rounded-lg bg-sky-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-sky-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-slate-950"
                      target="_blank"
                      rel="noreferrer"
                    >
                      Contact Sighthound
                    </a>
                  </div>
                  <p class="mt-1 text-[11px] text-slate-500 dark:text-slate-400">
                    Hardware is one-time. Software is recurring and shown separately above.
                  </p>
                </aside>
              </div>
            </section>
          </div>
        </div>
        <!-- Print-only assumptions section for PDF export -->
        <section class="mt-6 print-only">
          <h2 class="text-sm font-semibold text-slate-900">
            Assumptions &amp; definitions
          </h2>
          <ul class="mt-2 text-xs text-slate-700 space-y-1.5">
            <li>
              <strong>Total number of cameras:</strong>
              The total number of camera streams you want to analyze. Each camera counts as one stream.
            </li>
            <li>
              <strong>Standard IP cameras:</strong>
              Standard IP cameras capture video only. They do not run analytics like license plate recognition inside the camera.
            </li>
            <li>
              <strong>Smart / edge cameras:</strong>
              Smart or edge cameras process analytics inside the camera itself and typically cost more because each unit includes compute and software.
            </li>
            <li>
              <strong>Savings vs today:</strong>
              Hardware-only comparison of smart AI cameras today versus Sighthound Compute Node + standard IP cameras.
            </li>
            <li>
              <strong>Compute Nodes required:</strong>
              Each node supports up to 4 cameras. Rounded up.
            </li>
            <li>
              <strong>Cost per camera:</strong>
              Average hardware cost across the deployment.
            </li>
            <li>
              <strong>Sighthound software analytics:</strong>
              Software is priced per camera stream and billed separately from hardware.
            </li>
          </ul>
        </section>
      </main>
    </div>

    <script src="assets/params-schema.js"></script>
    <script src="assets/state-sync.js"></script>
    <script src="assets/calc-core.js"></script>
    <script src="script.js"></script>

      // Calculator wiring
      const totalCamerasInput = document.getElementById("totalCameras");
      const smartCameraCostInput = document.getElementById("smartCameraCost");
      const dumbCameraCostInput = document.getElementById("dumbCameraCost");
      const existingCamerasToggle = document.getElementById("existingCamerasToggle");
      const smartCamerasToggle = document.getElementById("smartCamerasToggle");
      const cameraTypeExclusivityNote = document.getElementById(
        "cameraTypeExclusivityNote"
      );
      const resetCalculatorButton = document.getElementById("resetCalculatorButton");
      const softwareSelectionInputs = document.querySelectorAll(
        'input[name="softwareSelection"]'
      );
      const softwareBillingFrequencySelect = document.getElementById(
        "softwareBillingFrequency"
      );

      const defaultSmartCameraCost = smartCameraCostInput
        ? smartCameraCostInput.value
        : "3000";
      const defaultDumbCameraCost = dumbCameraCostInput
        ? dumbCameraCostInput.value
        : "250";

      const resultsPlaceholder = document.getElementById("resultsPlaceholder");
      const resultsPanel = document.getElementById("resultsPanel");

      const primaryLabel = document.getElementById("primaryLabel");
      const primaryLabelText = document.getElementById("primaryLabelText");
      const primaryValue = document.getElementById("primaryValue");
      const primaryArrow = document.getElementById("primaryArrow");
      const primaryArrowIcon = document.getElementById("primaryArrowIcon");
      const primaryCard = document.getElementById("primaryCard");

      const currentTotalValue = document.getElementById("currentTotalValue");
      const sighthoundTotalValue = document.getElementById(
        "sighthoundTotalValue"
      );
      const todayLabelText = document.getElementById("todayLabelText");
      const sighthoundLabelText = document.getElementById("sighthoundLabelText");

      const breakdownToggle = document.getElementById("breakdownToggle");
      const breakdownPanel = document.getElementById("breakdownPanel");
      const todayBreakdownLine = document.getElementById("todayBreakdownLine");
      const sighthoundBreakdownNodes = document.getElementById(
        "sighthoundBreakdownNodes"
      );
      const sighthoundBreakdownCameras = document.getElementById(
        "sighthoundBreakdownCameras"
      );

      const recommendationText = document.getElementById("recommendationText");
      const contactCtaLink = document.getElementById("contactCtaLink");

      const nodesNeededValue = document.getElementById("nodesNeededValue");
      const percentReductionGroup = document.getElementById(
        "percentReductionGroup"
      );
      const percentReductionValue = document.getElementById(
        "percentReductionValue"
      );
      const percentArrowIcon = document.getElementById("percentArrowIcon");
      const costPerCameraLabel = document.getElementById("costPerCameraLabel");
      const costPerCameraBeforeRow = document.getElementById(
        "costPerCameraBeforeRow"
      );
      const costPerCameraAfterRow = document.getElementById(
        "costPerCameraAfterRow"
      );
      const costPerCameraBeforeValue = document.getElementById(
        "costPerCameraBeforeValue"
      );
      const costPerCameraAfterValue = document.getElementById(
        "costPerCameraAfterValue"
      );
      const softwareOverview = document.getElementById("softwareOverview");
      const softwareOverviewHeading = document.getElementById(
        "softwareOverviewHeading"
      );
      const softwareRecurringSummary = document.getElementById(
        "softwareRecurringSummary"
      );
      const softwareBillingNote = document.getElementById("softwareBillingNote");
      const downloadPdfButton = document.getElementById("downloadPdfButton");
      const deploymentDetailsIntro = document.getElementById(
        "deploymentDetailsIntro"
      );
      const softwareBreakdownLine = document.getElementById(
        "softwareBreakdownLine"
      );
      const softwareBreakdownHeading = document.getElementById(
        "softwareBreakdownHeading"
      );
      const costComparisonCard = document.getElementById("costComparisonCard");
      const deploymentDetailsCard = document.getElementById(
        "deploymentDetailsCard"
      );

      // Keep track of the last numeric results so we can animate between states
      let lastResults = null;

      // Utility to animate numeric changes like a fast odometer
      function animateNumberChange(
        el,
        previousValue,
        nextValue,
        formatFn,
        options = {}
      ) {
        if (!el || typeof formatFn !== "function") {
          return;
        }

        const duration = options.duration ?? 350;

        if (
          previousValue === null ||
          previousValue === undefined ||
          !Number.isFinite(previousValue)
        ) {
          el.textContent = formatFn(nextValue);
          return;
        }

        if (!Number.isFinite(nextValue) || previousValue === nextValue) {
          el.textContent = formatFn(nextValue);
          return;
        }

        const start = performance.now();
        const startVal = previousValue;
        const delta = nextValue - startVal;

        function frame(now) {
          const elapsed = now - start;
          const t = Math.min(1, elapsed / duration);
          const eased = 1 - Math.pow(1 - t, 3); // ease-out
          const current = startVal + delta * eased;
          el.textContent = formatFn(current);

          if (t < 1) {
            requestAnimationFrame(frame);
          }
        }

        requestAnimationFrame(frame);
      }

      if (breakdownToggle && breakdownPanel) {
        breakdownToggle.addEventListener("click", () => {
          const isHidden = breakdownPanel.classList.contains("hidden");
          if (isHidden) {
            breakdownPanel.classList.remove("hidden");
            breakdownToggle.textContent = "Hide breakdown";
            breakdownToggle.setAttribute("aria-expanded", "true");
          } else {
            breakdownPanel.classList.add("hidden");
            breakdownToggle.textContent = "Show breakdown";
            breakdownToggle.setAttribute("aria-expanded", "false");
          }
        });
      }

      if (resetCalculatorButton) {
        resetCalculatorButton.addEventListener("click", resetCalculator);
      }

      if (downloadPdfButton) {
        downloadPdfButton.addEventListener("click", () => {
          // Ensure breakdown and software details are visible in the exported PDF.
          if (breakdownPanel && breakdownPanel.classList.contains("hidden")) {
            breakdownPanel.classList.remove("hidden");
            if (breakdownToggle) {
              breakdownToggle.textContent = "Hide breakdown";
              breakdownToggle.setAttribute("aria-expanded", "true");
            }
          }
          window.print();
        });
      }

      const helperToggleButtons = document.querySelectorAll(
        "[data-helper-target]"
      );
      helperToggleButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const targetId = btn.getAttribute("data-helper-target");
          if (!targetId) return;
          const target = document.getElementById(targetId);
          if (!target) return;
          target.classList.toggle("hidden");
        });
      });

      function handleCameraTypeChange(changed) {
        if (!existingCamerasToggle || !smartCamerasToggle) {
          updateResultsAndFlash("totalCameras");
          return;
        }

        let autoCorrected = false;

        if (
          changed === "standard" &&
          existingCamerasToggle.checked &&
          smartCamerasToggle.checked
        ) {
          smartCamerasToggle.checked = false;
          autoCorrected = true;
        } else if (
          changed === "smart" &&
          smartCamerasToggle.checked &&
          existingCamerasToggle.checked
        ) {
          existingCamerasToggle.checked = false;
          autoCorrected = true;
        }

        if (cameraTypeExclusivityNote) {
          if (autoCorrected) {
            cameraTypeExclusivityNote.classList.remove("hidden");
          } else {
            cameraTypeExclusivityNote.classList.add("hidden");
          }
        }

        const sourceKey =
          changed === "standard" ? "existingCamerasToggle" : "smartCamerasToggle";
        updateResultsAndFlash(sourceKey);
      }

      if (existingCamerasToggle) {
        existingCamerasToggle.addEventListener("change", () => {
          handleCameraTypeChange("standard");
        });
      }

      if (smartCamerasToggle) {
        smartCamerasToggle.addEventListener("change", () => {
          handleCameraTypeChange("smart");
        });
      }

      function resetCalculator() {
        if (totalCamerasInput) {
          totalCamerasInput.value = "";
        }
        if (smartCameraCostInput) {
          smartCameraCostInput.value = defaultSmartCameraCost;
        }
        if (dumbCameraCostInput) {
          dumbCameraCostInput.value = defaultDumbCameraCost;
        }
        if (existingCamerasToggle) {
          existingCamerasToggle.checked = false;
        }
        if (smartCamerasToggle) {
          smartCamerasToggle.checked = false;
        }
        if (cameraTypeExclusivityNote) {
          cameraTypeExclusivityNote.classList.add("hidden");
        }
        if (softwareBillingFrequencySelect) {
          softwareBillingFrequencySelect.value = "monthly";
        }
        if (softwareSelectionInputs && softwareSelectionInputs.length) {
          softwareSelectionInputs.forEach((input) => {
            if (input.value === "both") {
              input.checked = true;
            } else {
              input.checked = false;
            }
          });
        }
        if (State && State.writeState) {
          State.writeState(null);
        }
        updateResults();
      }

      function setSectionEnabled(sectionEl, enabled) {
        if (!sectionEl) return;
        if (enabled) {
          sectionEl.classList.remove("opacity-60", "pointer-events-none");
        } else {
          sectionEl.classList.add("opacity-60", "pointer-events-none");
        }
      }

      function toggleWithFade(el, show) {
        if (!el) return;

        el.classList.add(
          "transition-opacity",
          "duration-150",
          "ease-out",
          "transform"
        );

        if (show) {
          if (!el.classList.contains("hidden")) {
            el.classList.remove("opacity-0", "translate-y-1");
            el.classList.add("opacity-100", "translate-y-0");
            return;
          }

          el.classList.remove("hidden");
          el.classList.add("opacity-0", "translate-y-1");
          el.classList.remove("opacity-100", "translate-y-0");

          requestAnimationFrame(() => {
            el.classList.remove("opacity-0", "translate-y-1");
            el.classList.add("opacity-100", "translate-y-0");
          });
        } else {
          if (el.classList.contains("hidden")) return;

          el.classList.remove("opacity-100", "translate-y-0");
          el.classList.add("opacity-0", "translate-y-1");

          const handle = (event) => {
            if (event.target !== el) return;
            el.classList.add("hidden");
            el.removeEventListener("transitionend", handle);
          };

          el.addEventListener("transitionend", handle);
        }
      }

      function flash(el, variant = "neutral") {
        if (!el) return;

        const baseRingClasses = ["ring-2", "ring-offset-2"];
        const neutralBgClass = "bg-slate-50";
        let ringColorClass = "ring-slate-300";
        let addBackground = false;

        if (variant === "savings-positive") {
          ringColorClass = "ring-green-300";
        } else if (variant === "savings-negative") {
          ringColorClass = "ring-red-300";
        } else {
          addBackground = true;
        }

        const classesToAdd = [...baseRingClasses, ringColorClass];
        if (addBackground) {
          classesToAdd.push(neutralBgClass);
        }

        const allHighlightClasses = [
          ...baseRingClasses,
          "ring-slate-300",
          "ring-green-300",
          "ring-red-300",
          neutralBgClass,
        ];

        if (el._flashTimeoutId) {
          clearTimeout(el._flashTimeoutId);
        }

        el.classList.remove(...allHighlightClasses);
        el.classList.add(...classesToAdd);

        el._flashTimeoutId = setTimeout(() => {
          el.classList.remove(...classesToAdd);
          el._flashTimeoutId = null;
        }, 500);
      }

      function updateResults() {
        const sectionCurrentApproach = document.getElementById(
          "sectionCurrentApproach"
        );
        const sectionSighthound = document.getElementById("sectionSighthound");

        const totalCamerasRaw = totalCamerasInput ? totalCamerasInput.value : "";
        const totalCamerasTrimmed = String(totalCamerasRaw ?? "").trim();
        const totalCamerasParsed = Number(totalCamerasTrimmed);
        const hasValidTotalCameras =
          totalCamerasTrimmed !== "" &&
          Number.isInteger(totalCamerasParsed) &&
          totalCamerasParsed >= 1 &&
          totalCamerasParsed <= 10000;

        setSectionEnabled(sectionCurrentApproach, hasValidTotalCameras);
        setSectionEnabled(sectionSighthound, hasValidTotalCameras);

        const hasStandardIp = existingCamerasToggle
          ? existingCamerasToggle.checked
          : false;
        const hasSmartCameras = smartCamerasToggle
          ? smartCamerasToggle.checked
          : false;

        let scenario = "C";
        if (hasSmartCameras) {
          scenario = "A";
        } else if (hasStandardIp) {
          scenario = "B";
        }

        if (deploymentDetailsIntro) {
          if (scenario === "A") {
            deploymentDetailsIntro.textContent =
              "A quick breakdown of Compute Nodes required, cost reduction, and cost per camera.";
          } else if (scenario === "B") {
            deploymentDetailsIntro.textContent =
              "How many Compute Nodes you need and the effective hardware cost to enable analytics on existing cameras.";
          } else {
            deploymentDetailsIntro.textContent =
              "How many Compute Nodes you need and the average hardware cost per camera for this deployment.";
          }
        }

        if (
          costPerCameraLabel &&
          costPerCameraBeforeRow &&
          costPerCameraAfterRow
        ) {
          if (scenario === "A") {
            costPerCameraLabel.textContent = "Cost per camera (hardware only)";
            toggleWithFade(costPerCameraBeforeRow, true);
            toggleWithFade(costPerCameraAfterRow, true);
          } else if (scenario === "B") {
            costPerCameraLabel.textContent =
              "Effective per-camera enablement cost (hardware only)";
            toggleWithFade(costPerCameraBeforeRow, false);
            toggleWithFade(costPerCameraAfterRow, true);
          } else {
            costPerCameraLabel.textContent = "Cost per camera (hardware only)";
            toggleWithFade(costPerCameraBeforeRow, false);
            toggleWithFade(costPerCameraAfterRow, true);
          }
        }

        if (sectionCurrentApproach) {
          toggleWithFade(sectionCurrentApproach, scenario === "A");
        }

        const standardIpCameraCostGroup = document.getElementById(
          "standardIpCameraCostGroup"
        );
        const scenarioBNote = document.getElementById("scenarioBNote");

        if (standardIpCameraCostGroup) {
          // Always allow entering an estimated standard IP camera cost, regardless of scenario.
          toggleWithFade(standardIpCameraCostGroup, true);
          standardIpCameraCostGroup.classList.remove(
            "opacity-60",
            "pointer-events-none"
          );
        }

        if (scenarioBNote) {
          toggleWithFade(scenarioBNote, scenario === "B");
        }

        const hasExistingCameras = hasStandardIp && !hasSmartCameras;

        const smartCameraCostRaw = smartCameraCostInput
          ? smartCameraCostInput.value
          : "";
        const dumbCameraCostRaw = dumbCameraCostInput
          ? dumbCameraCostInput.value
          : "";

        const baseResult = Calculator.computeTotalsFromRaw({
          totalCamerasRaw,
          smartCameraCostRaw,
          dumbCameraCostRaw,
        });

        if (!baseResult.ok) {
          resultsPanel.classList.add("hidden");
          resultsPlaceholder.classList.remove("hidden");
          if (recommendationText) {
            recommendationText.textContent =
              "Enter a camera count between 1 and 10,000 and valid hardware costs to see the estimate.";
          }
          if (softwareRecurringSummary && softwareOverview) {
            softwareOverview.classList.remove("hidden");
            softwareRecurringSummary.textContent =
              "Software cost will appear here once cameras are entered.";
          }
          return;
        }

        const {
          totalCameras,
          smartCameraCost,
          dumbCameraCost,
          nodesNeeded,
          currentTotal,
        } = baseResult.values;

        const sighthoundCameraHardwareTotal = hasExistingCameras
          ? 0
          : totalCameras * dumbCameraCost;
        const sighthoundTotal =
          nodesNeeded * Calculator.NODE_COST + sighthoundCameraHardwareTotal;
        const savings = currentTotal - sighthoundTotal;
        const percentReduction =
          currentTotal === 0 ? 0 : (savings / currentTotal) * 100;
        const costPerCameraBefore =
          totalCameras === 0 ? 0 : currentTotal / totalCameras;
        const costPerCameraAfter =
          totalCameras === 0 ? 0 : sighthoundTotal / totalCameras;

        // Sighthound software recurring cost (does not affect hardware totals)
        let softwareMonthlyTotal = 0;
        let softwareYearlyTotal = 0;
        let effectiveSoftwareTotal = 0;
        let softwareFrequencyLabel = "per month";
        let softwareFrequencyUiLabel = "monthly";

        if (totalCameras > 0 && softwareSelectionInputs) {
          let selected = "both";
          softwareSelectionInputs.forEach((input) => {
            if (input.checked) {
              selected = input.value;
            }
          });
          const billingFrequency = softwareBillingFrequencySelect
            ? softwareBillingFrequencySelect.value
            : "monthly";
          const perCameraMonthly =
            Calculator.getSoftwareMonthlyPricePerCamera(selected);
          softwareMonthlyTotal = totalCameras * perCameraMonthly;
          softwareYearlyTotal = softwareMonthlyTotal * 12;
          if (billingFrequency === "yearly") {
            effectiveSoftwareTotal = softwareYearlyTotal;
            softwareFrequencyLabel = "per year";
            softwareFrequencyUiLabel = "annual (estimated)";
          } else {
            effectiveSoftwareTotal = softwareMonthlyTotal;
            softwareFrequencyLabel = "per month";
            softwareFrequencyUiLabel = "monthly";
          }
        }

        const previousResults = lastResults;
        lastResults = {
          totalCameras,
          smartCameraCost,
          dumbCameraCost,
          nodesNeeded,
          currentTotal,
          sighthoundTotal,
          savings,
          percentReduction,
          costPerCameraBefore,
          costPerCameraAfter,
          softwareMonthlyTotal,
          softwareYearlyTotal,
          effectiveSoftwareTotal,
          scenario,
        };

        // Toggle panels
        resultsPlaceholder.classList.add("hidden");
        resultsPanel.classList.remove("hidden");

        // Keep URL shareable with current configuration
        if (State && State.writeState) {
          State.writeState({
            cameras: totalCameras,
            smart: smartCameraCost,
            dumb: dumbCameraCost,
          });
        }

        const isSavingsPositiveOrZero = savings >= 0;

        // Scenario-specific primary card and savings logic (Scenario A only)
        if (scenario === "A") {
          if (primaryCard) {
            // Ensure the card participates in layout when Scenario A is active.
            primaryCard.style.display = "";
            toggleWithFade(primaryCard, true);
          }

          if (primaryLabelText) {
            primaryLabelText.textContent = isSavingsPositiveOrZero
              ? "Savings vs today"
              : "Extra cost vs today";
          }
          animateNumberChange(
            primaryValue,
            previousResults ? Math.abs(previousResults.savings ?? 0) : null,
            Math.abs(savings),
            (val) => Calculator.formatCurrency(val)
          );

          if (primaryCard) {
            const basePrimaryClasses =
              "rounded-xl shadow-sm border p-5 sm:p-6 flex flex-col gap-4 dark:bg-slate-900 dark:border-slate-700";
            const positiveClasses =
              " bg-green-50 border border-green-200 border-l-4 border-l-green-500";
            const negativeClasses =
              " bg-red-50 border border-red-200 border-l-4 border-l-red-500";
            primaryCard.className =
              basePrimaryClasses +
              (isSavingsPositiveOrZero ? positiveClasses : negativeClasses);
          }

          if (primaryLabel) {
            primaryLabel.className =
              "text-sm font-medium flex items-center gap-1.5 " +
              (isSavingsPositiveOrZero
                ? "text-slate-700 dark:text-slate-200"
                : "text-rose-700 dark:text-rose-300");
          }

          if (primaryValue) {
            primaryValue.className =
              "mt-1 text-4xl sm:text-5xl font-semibold tracking-tight tabular-nums " +
              (isSavingsPositiveOrZero
                ? "text-emerald-600 dark:text-emerald-400"
                : "text-rose-600 dark:text-rose-400");
          }

          if (recommendationText) {
            if (isSavingsPositiveOrZero) {
              recommendationText.textContent =
                "Based on these inputs, Sighthound Compute Node + standard IP cameras has a lower upfront hardware cost than smart AI cameras.";
            } else {
              recommendationText.textContent =
                "Based on these inputs, Sighthound Compute Node + standard IP cameras has a higher upfront hardware cost than smart AI cameras.";
            }
          }

          // Primary arrow styling (down = good / up = bad)
          primaryArrow.className =
            "inline-flex h-8 w-8 items-center justify-center rounded-full " +
            (isSavingsPositiveOrZero
              ? "bg-emerald-50 text-emerald-600"
              : "bg-rose-50 text-rose-600");

          primaryArrowIcon.className =
            "h-4 w-4 transition-transform duration-150" +
            (isSavingsPositiveOrZero ? "" : " rotate-180");
        } else if (primaryCard) {
          // In non-Scenario-A views, remove the savings card from layout entirely
          // so there is no extra whitespace between cost comparison and deployment details.
          primaryCard.classList.add("hidden");
          primaryCard.style.display = "none";
        }

        // Cost comparison block (scenario-specific)
        if (todayLabelText && sighthoundLabelText) {
          if (scenario === "A") {
            todayLabelText.textContent = "Today  smart AI cameras";
            sighthoundLabelText.textContent =
              "With Sighthound Compute Hardware";
          } else if (scenario === "B") {
            todayLabelText.textContent = "Existing camera hardware";
            sighthoundLabelText.textContent = "Upfront node cost";
          } else {
            todayLabelText.textContent = "Existing camera hardware";
            sighthoundLabelText.textContent =
              "New deployment hardware cost (nodes + cameras)";
          }
        }

        if (scenario === "A") {
          animateNumberChange(
            currentTotalValue,
            previousResults ? previousResults.currentTotal : null,
            currentTotal,
            (val) => Calculator.formatCurrency(val)
          );
          animateNumberChange(
            sighthoundTotalValue,
            previousResults ? previousResults.sighthoundTotal : null,
            sighthoundTotal,
            (val) => Calculator.formatCurrency(val)
          );
        } else if (scenario === "B") {
          if (currentTotalValue) {
            currentTotalValue.textContent = "Already installed";
          }
          animateNumberChange(
            sighthoundTotalValue,
            previousResults ? previousResults.sighthoundTotal : null,
            sighthoundTotal,
            (val) => Calculator.formatCurrency(val)
          );
        } else {
          if (currentTotalValue) {
            currentTotalValue.textContent =
              "No current cameras (new deployment)";
          }
          animateNumberChange(
            sighthoundTotalValue,
            previousResults ? previousResults.sighthoundTotal : null,
            sighthoundTotal,
            (val) => Calculator.formatCurrency(val)
          );
        }

        if (todayBreakdownLine) {
          if (scenario === "A") {
            animateNumberChange(
              todayBreakdownLine,
              previousResults ? previousResults.totalCameras : null,
              totalCameras,
              (val) => {
                const rounded = Math.round(val);
                return `Cameras: ${rounded.toLocaleString("en-US")} x ${Calculator.formatCurrency(
                  smartCameraCost
                )} = ${Calculator.formatCurrency(rounded * smartCameraCost)}`;
              }
            );
          } else if (scenario === "B") {
            todayBreakdownLine.textContent =
              "Existing cameras: already installed (no new camera hardware cost modeled here).";
          } else {
            todayBreakdownLine.textContent =
              "No existing cameras (new deployment).";
          }
        }

        if (sighthoundBreakdownNodes) {
          animateNumberChange(
            sighthoundBreakdownNodes,
            previousResults ? previousResults.nodesNeeded : null,
            nodesNeeded,
            (val) => {
              const rounded = Math.round(val);
              return `Compute Nodes: ${rounded.toLocaleString("en-US")} x ${Calculator.formatCurrency(
                Calculator.NODE_COST
              )} = ${Calculator.formatCurrency(
                rounded * Calculator.NODE_COST
              )}`;
            }
          );
        }

        if (sighthoundBreakdownCameras) {
          if (scenario === "B" || hasExistingCameras) {
            sighthoundBreakdownCameras.textContent =
              `Reusing existing cameras: ${Calculator.formatCurrency(0)}`;
          } else {
            animateNumberChange(
              sighthoundBreakdownCameras,
              previousResults ? previousResults.totalCameras : null,
              totalCameras,
              (val) => {
                const rounded = Math.round(val);
                return `Standard IP cameras: ${rounded.toLocaleString(
                  "en-US"
                )} x ${Calculator.formatCurrency(
                  dumbCameraCost
                )} = ${Calculator.formatCurrency(rounded * dumbCameraCost)}`;
              }
            );
          }
        }

        // Secondary metrics
        animateNumberChange(
          nodesNeededValue,
          previousResults ? previousResults.nodesNeeded : null,
          nodesNeeded,
          (val) => Math.round(val).toLocaleString("en-US")
        );

        if (percentReductionGroup) {
          toggleWithFade(percentReductionGroup, scenario === "A");
        }

        if (scenario === "A") {
          animateNumberChange(
            percentReductionValue,
            previousResults ? previousResults.percentReduction : null,
            percentReduction,
            (val) => Calculator.formatPercent(val)
          );
          percentReductionValue.className =
            "font-medium tabular-nums " +
            (isSavingsPositiveOrZero ? "text-emerald-600" : "text-rose-600");

          percentArrowIcon.className =
            "inline-flex h-5 w-5 items-center justify-center rounded-full " +
            (isSavingsPositiveOrZero
              ? "bg-emerald-50 text-emerald-600"
              : "bg-rose-50 text-rose-600");

          const percentArrowSvg = percentArrowIcon.querySelector("svg");
          if (percentArrowSvg) {
            percentArrowSvg.className =
              "h-3 w-3 transition-transform duration-150" +
              (isSavingsPositiveOrZero ? "" : " rotate-180");
          }
        }

        animateNumberChange(
          costPerCameraBeforeValue,
          previousResults ? previousResults.costPerCameraBefore : null,
          costPerCameraBefore,
          (val) => Calculator.formatCurrency(val)
        );
        animateNumberChange(
          costPerCameraAfterValue,
          previousResults ? previousResults.costPerCameraAfter : null,
          costPerCameraAfter,
          (val) => Calculator.formatCurrency(val)
        );

        // Update software overview lines (Sighthound only, recurring)
        if (softwareOverview && softwareRecurringSummary) {
          softwareOverview.classList.remove("hidden");
          if (softwareOverviewHeading) {
            softwareOverviewHeading.textContent =
              `Your software costs (recurring  ${softwareFrequencyUiLabel})`;
          }
          if (effectiveSoftwareTotal > 0) {
            softwareRecurringSummary.textContent =
              "Your software costs: " +
              Calculator.formatCurrency(effectiveSoftwareTotal) +
              ` ${softwareFrequencyLabel} for ${totalCameras.toLocaleString(
                "en-US"
              )} cameras.`;
          } else {
            softwareRecurringSummary.textContent =
              "Software cost will appear here once cameras are entered.";
          }
        }

        if (softwareBreakdownLine) {
          if (softwareMonthlyTotal > 0 && totalCameras > 0) {
            const billingFrequency = softwareBillingFrequencySelect
              ? softwareBillingFrequencySelect.value
              : "monthly";

            if (billingFrequency === "yearly") {
              const perCameraYearly = softwareYearlyTotal / totalCameras;
              softwareBreakdownLine.textContent =
                `Your software costs: ${totalCameras.toLocaleString(
                  "en-US"
                )} x ${Calculator.formatCurrency(
                  perCameraYearly
                )} per camera per year = ${Calculator.formatCurrency(
                  softwareYearlyTotal
                )} per year.`;
            } else {
              const perCameraMonthly = softwareMonthlyTotal / totalCameras;
              softwareBreakdownLine.textContent =
                `Your software costs: ${totalCameras.toLocaleString(
                  "en-US"
                )} x ${Calculator.formatCurrency(
                  perCameraMonthly
                )} per camera per month = ${Calculator.formatCurrency(
                  softwareMonthlyTotal
                )} per month.`;
            }
          } else {
            softwareBreakdownLine.textContent =
              "Your software costs are calculated per camera per month and shown separately from hardware.";
          }
        }
      }

      function applyFlashForSource(sourceKey) {
        if (!lastResults || !resultsPanel) return;
        if (resultsPanel.classList.contains("hidden")) return;

        const { scenario, savings } = lastResults;
        const isSavingsPositiveOrZero = (savings ?? 0) >= 0;
        const savingsVariant = isSavingsPositiveOrZero
          ? "savings-positive"
          : "savings-negative";

        const flashSavingsIfVisible = () => {
          if (
            scenario === "A" &&
            primaryCard &&
            !primaryCard.classList.contains("hidden")
          ) {
            flash(primaryCard, savingsVariant);
          }
        };

        switch (sourceKey) {
          case "totalCameras":
          case "existingCamerasToggle":
          case "smartCamerasToggle": {
            if (costComparisonCard) flash(costComparisonCard, "neutral");
            if (deploymentDetailsCard) flash(deploymentDetailsCard, "neutral");
            if (softwareOverview) flash(softwareOverview, "neutral");
            flashSavingsIfVisible();
            break;
          }
          case "smartCameraCost": {
            if (costComparisonCard) flash(costComparisonCard, "neutral");
            if (costPerCameraBeforeRow)
              flash(costPerCameraBeforeRow, "neutral");
            flashSavingsIfVisible();
            break;
          }
          case "dumbCameraCost": {
            if (costComparisonCard) flash(costComparisonCard, "neutral");
            if (costPerCameraAfterRow) flash(costPerCameraAfterRow, "neutral");
            if (scenario === "A") {
              flashSavingsIfVisible();
            }
            break;
          }
          case "softwareSelection": {
            if (softwareOverview) flash(softwareOverview, "neutral");
            if (breakdownPanel && !breakdownPanel.classList.contains("hidden")) {
              flash(breakdownPanel, "neutral");
            }
            break;
          }
          case "billingFrequency": {
            if (softwareOverview) flash(softwareOverview, "neutral");
            break;
          }
          default:
            break;
        }
      }

      function updateResultsAndFlash(sourceKey) {
        updateResults();
        applyFlashForSource(sourceKey);
      }

      function initFromState() {
        if (!State || !State.readState) return;
        try {
          const state = State.readState();
          if (!state || typeof state !== "object") return;

          if (state.cameras !== undefined && state.cameras !== null && totalCamerasInput) {
            totalCamerasInput.value = state.cameras;
          }
          if (state.smart !== undefined && state.smart !== null && smartCameraCostInput) {
            smartCameraCostInput.value = state.smart;
          }
          if (state.dumb !== undefined && state.dumb !== null && dumbCameraCostInput) {
            dumbCameraCostInput.value = state.dumb;
          }
        } catch (e) {}
      }

      initFromState();
      updateResults();

      const inputToSourceKey = [
        [totalCamerasInput, "totalCameras"],
        [smartCameraCostInput, "smartCameraCost"],
        [dumbCameraCostInput, "dumbCameraCost"],
        [softwareBillingFrequencySelect, "billingFrequency"],
      ];

      inputToSourceKey.forEach(([input, sourceKey]) => {
        if (!input) return;
        input.addEventListener("input", () => updateResultsAndFlash(sourceKey));
        input.addEventListener("change", () => updateResultsAndFlash(sourceKey));
      });

      if (softwareSelectionInputs && softwareSelectionInputs.length) {
        softwareSelectionInputs.forEach((input) => {
          input.addEventListener("change", () =>
            updateResultsAndFlash("softwareSelection")
          );
        });
      }
    </script>
  </body>
</html>
